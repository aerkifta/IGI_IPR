{% extends 'main/base.html' %}

{% block title %}{{title}}{% endblock %}

{% block content %}
<div class="shop-wrapper">

    <h1 class="page-title">Товары, которые можно приобрести</h1>

    <div id="cart-count" class="cart-count">Корзина: 0</div>
<a href="{% url 'basket' %}" class="btn-cart">Перейти в корзину</a>

    <div class="shop-grid">
        {% for item in purchased_exhibits %}
        <div class="shop-card">

            {% if item.exhibit.image %}
                <img src="{{ item.exhibit.image.url }}" alt="{{ item.exhibit.name }}" class="shop-img">
            {% else %}
                <div class="shop-img placeholder">Нет изображения</div>
            {% endif %}

            <h3 class="shop-name">{{ item.exhibit.name }}</h3>
            <p class="shop-desc">{{ item.exhibit.description|truncatewords:20 }}</p>

            <div class="shop-bottom">
                <span class="shop-price">{{ item.price }} BYN</span>

                <button class="btn-add"
                        onclick="addToCart('{{ item.id }}', '{{ item.exhibit.name }}', '{{ item.price }}')">
                    Добавить в корзину
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    if (!localStorage.getItem("cart")) {
        localStorage.setItem("cart", JSON.stringify([]));
    }

    function addToCart(id, name, price) {
        let cart = JSON.parse(localStorage.getItem("cart"));
        cart.push({id: id, name: name, price: price});
        localStorage.setItem("cart", JSON.stringify(cart));
        document.getElementById("cart-count").innerText = "Корзина: " + cart.length;
    }

    document.addEventListener("DOMContentLoaded", function() {
        let cart = JSON.parse(localStorage.getItem("cart"));
        document.getElementById("cart-count").innerText = "Корзина: " + cart.length;
    });
</script>

<style>
    .shop-wrapper {
        padding: 20px;
    }

    .page-title {
        font-size: 32px;
        margin-bottom: 20px;
    }

    .cart-count {
        font-size: 18px;
        margin-bottom: 20px;
        background: #eee;
        padding: 10px 15px;
        display: inline-block;
        border-radius: 6px;
    }

    .shop-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 20px;
    }

    .shop-card {
        background: white;
        border-radius: 12px;
        padding: 15px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
    }

    .shop-img {
        width: 100%;
        height: 220px;
        object-fit: cover;
        border-radius: 10px;
        margin-bottom: 10px;
    }

    .shop-img.placeholder {
        display: flex;
        justify-content: center;
        align-items: center;
        background: #f0f0f0;
        color: #555;
        font-size: 14px;
        font-style: italic;
    }

    .shop-name {
        font-size: 20px;
        margin: 10px 0 5px;
    }

    .shop-desc {
        flex-grow: 1;
        color: #444;
        font-size: 14px;
        margin-bottom: 15px;
    }

    .shop-bottom {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .shop-price {
        font-weight: bold;
        font-size: 18px;
    }

    .btn-add {
        background: #1a73e8;
        color: white;
        padding: 8px 14px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: 0.2s;
    }

    .btn-add:hover {
        background: #155fc0;
    }

    .btn-cart {
    background: #4caf50;
    color: white;
    padding: 10px 16px;
    border-radius: 8px;
    text-decoration: none;
}

</style>

{% endblock %}
